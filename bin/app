#!/bin/bash
#set -x

## We include the global environment.
## Make your changes in the bin/.env file
source "$(cd $(dirname $(cd $(dirname $0);pwd -P));pwd -P)/bin/env"

## Change CWD to the Apps main root directory
cd $APP_HOME

## Display Usage Information 
usage() {
	cat << EOF
usage: $0 command [command options]

This is the usage description of your app.

Available Commands:
   start          Start the app
   stop           Stop the app
   install        Initially installs and configures the environment of the app
EOF
}

COMMAND="$1"
shift

if [[ -z $COMMAND ]]; then
	usage
	exit 1
fi

# First we try to run the command
# with the configured node version
node $APP_LIB $COMMAND "$@"
RET="$?"

# If command couldn't be executed 
# try to execute it so PATH is searched for it.
# So make sure to populate your PATH properly
# in bin/env
if [[ $RET -eq 2 ]]; then
	if [[ -x $COMMAND ]]; then
		$COMMAND "$@"
		exit $?
	fi
fi

if [[ $RET -ne 2 && $RET -ne 0 ]]; then
	echo
	usage
fi

exit $RET
